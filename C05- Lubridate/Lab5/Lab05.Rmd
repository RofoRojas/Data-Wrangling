---
title: "Lab05"
author: "Rodolfo"
date: "8/9/2019"
output: rmarkdown::github_document
---
# Laboratorio 5
```{r, echo=TRUE, cache=TRUE}
library(lubridate)
library(dplyr)
library(readr)
library(readxl)
library(plotly)
```
## Parte 1
Predecir un eclipse:
En tiempo de Norte América, el eclipse total inició el 21 de agosto del 2017 a las 18:26:40.
Este mismo evento, sucederá un Saros después.
Un Saros equivale a 223 Synodic Months
Un Synodic Month equivale a 29 días con 12 horas, con 44 minutos y 3 segundos.

variables
```{r, echo=TRUE, cache=TRUE}
historico <- dmy_hms("21th August, 2017 18:26:40", tz = "EST")
Synodic_Month <- duration(day=29, hour= 12, minute= 44, second= 3)
Saros <- duration(223*Synodic_Month)
```

```{r, echo=TRUE, cache=TRUE}
proximo <- historico+Saros
print(paste("El proximo eclipse ocurrira en: ", proximo, sep = ""))
```
## Parte 2
importar datos
Nota: para  poder importarlos lo pase a un archivo csv y tambien quite las tildes por problema de encoding en mi computadora.
```{r, echo=TRUE, cache=TRUE}
data <- read_csv("data.csv")
glimpse(data)
```
parsing dates
```{r, echo=TRUE, cache=TRUE}
## Modificando las Horas
data$`Hora Creacion` <- paste(substr(data$`Hora Creacion`,1, nchar(data$`Hora Creacion`)-6), substr(data$`Hora Creacion`, nchar(data$`Hora Creacion`)-4, nchar(data$`Hora Creacion`)-4),"m",sep="")

data$`Hora Final` <- paste(substr(data$`Hora Final`,1, nchar(data$`Hora Final`)-6), substr(data$`Hora Final`, nchar(data$`Hora Final`)-4, nchar(data$`Hora Final`)-4),"m",sep="")

## Parseando la fecha
data <- data %>% 
  mutate(Creacion= dmy_hm(paste(data$`Fecha Creacion`, data$`Hora Creacion`, sep = " ")), Final= dmy_hm(paste(data$`Fecha Final`, data$`Hora Final`, sep = " "))) %>% 
  select(Creacion, `Caller ID`, Cod, Email, SMS, Call, Final)
glimpse(data)
```
### Preguntas
● ¿En qué meses existe una mayor cantidad de llamadas por código?
```{r, echo=TRUE, cache=TRUE}
data %>% 
  group_by(Codigo= as.factor(Cod), Mes=as.factor(month(Creacion))) %>%
  summarise(llamadas=n()) #%>% 
  # plot_ly(x=~Mes, y=~llamadas, color=~Codigo, colors = "Paired") %>% 
  # layout(title="Llamadas por codigo por mes", barmode="group")
```
plot_ly(x=~Mes, y=~llamadas, color=~Codigo, colors = "Paired") %>% 
layout(title="Llamadas por codigo por mes", barmode="group")


● ¿Qué día de la semana es el más ocupado?
R//Domingo
```{r, echo=TRUE, cache=TRUE}
data %>% 
  group_by(Dia=wday(Creacion, label = T)) %>% count() #%>%
  # plot_ly(x=~Dia, y=~n, color=~Dia ,colors= "Spectral") %>%
  # layout(title="Llamadas por dia de la Semana")
```
plot_ly(x=~Dia, y=~n, color=~Dia ,colors= "Spectral") %>%
layout(title="Llamadas por dia de la Semana")

● ¿Qué mes es el más ocupado?
R// Mayo
```{r, echo=TRUE, cache=TRUE}
data %>% 
  group_by(Mes=month(Creacion, label = T)) %>% count() #%>%
  # plot_ly(x=~Mes, y=~n, color=~Mes ,colors= "Spectral") %>% 
  # layout(title="Llamadas por Mes")
```
plot_ly(x=~Mes, y=~n, color=~Mes ,colors= "Spectral") %>% 
layout(title="Llamadas por Mes")

● ¿Existe una temporalidad en la cantidad de llamadas?
No parece que la haya
```{r, echo=TRUE, cache=TRUE}
data %>% 
  group_by(Fecha=date(Creacion)) %>%  summarise(llamadas= n()) #%>% 
  # plot_ly(x=~Fecha, y=~llamadas, type = "scatter", mode= "lines") %>%
  # layout(title= "Llamadas diarias en el tiempo")
```
  plot_ly(x=~Fecha, y=~llamadas, type = "scatter", mode= "lines") %>%
  layout(title= "Llamadas diarias en el tiempo")
  
  
● ¿Cuántos minutos dura la llamada promedio?
R// Dura en promedio 7M y 46.82 S, esto incluyendo las duraciones negativas por errores de ingreso.

```{r, echo=TRUE, cache=TRUE}
data %>% 
  mutate(Duracion= seconds(int_length(Creacion%--%Final))) %>% summarise(Min_Promedio=seconds_to_period(mean(Duracion)))
```
```{r, echo=TRUE, cache=TRUE}
data %>% 
  mutate(Duracion= (int_length(Creacion%--%Final))) #%>% 
  # plot_ly(x=~Duracion, type = "box")
```
plot_ly(x=~Duracion, type = "box")

● Realice una tabla de frecuencias con el tiempo de llamada.
```{r, echo=TRUE, cache=TRUE}
data %>% 
  mutate(`Tiempo de Llamada en Minutos`= (int_length(Creacion%--%Final)/60)%/%5*5) %>%
  filter(`Tiempo de Llamada en Minutos`>=0) %>% 
  group_by(`Tiempo de Llamada en Minutos`) %>% count()
```

```{r, echo=TRUE, cache=TRUE}
data %>% 
  mutate(`Tiempo de Llamada en Minutos`= int_length(Creacion%--%Final)/60) %>%
  filter(`Tiempo de Llamada en Minutos`>=0) #%>% 
  # plot_ly(x=~`Tiempo de Llamada en Minutos`, type = "histogram", xbins = list(start=0, end=30, size=5)) 
```
plot_ly(x=~`Tiempo de Llamada en Minutos`, type = "histogram", xbins = list(start=0, end=30, size=5)) 
